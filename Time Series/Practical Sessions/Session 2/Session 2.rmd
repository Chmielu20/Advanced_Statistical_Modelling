---
title: "Session 1: Transformation into Stationarity"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### GDPUSAvar: gross domestic product variation of the United States. Quarter I-1990 - Quarter IV-2019

Percent change over the previous period (quarter) of the gross domestic product of the United States; official web http://www.bea.gov/national/index.htm. Quarter I-1990 - Quarter IV-2019; 30 years. The series is seasonally adjusted.

### I. Exploratory data analysis and transformation into stationarity

#### Ia. Exploratory data analysis

Import the data

```{r}
(serie=ts((read.table("gdpUSAvar.dat",header=F)),start=1990,freq=4))
```

```{r}
plot(serie)
abline(v=1990:2020,col=4,lty=3)
abline(h=0)
```

#### Ib. Tranforming series into a stationary one:


```{r}
groupedserie <- matrix(serie, ncol=12) #12 quarters=3yrs together=ncol=12
boxplot(groupedserie)
```

#### Is seasonality present?

Nop, GDPUSAvar series has been previously seasonally adjusted and it represents already percentage variation

#### Is the mean constant?

```{r}
plot(serie)
abline(h=0)
abline(h=mean(serie),col=2)
```
```{r}
mean(serie) 
```


#### Check for over-differentiation: Take an extra differentiation and compare the variances.

```{r}
d1serie=diff(serie)
plot(d1serie)
abline(h=0)
abline(h=mean(d1serie),col=2)
```

```{r}
var(serie)
var(d1serie)
```

#### Is an extra differentiation needed?

#### Is the current series already stationary? Plot the ACF and decide!!

```{r}
par(mfrow=c(1,2))
acf(serie,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,3)), main ="ACF(serie)",lwd=2)
pacf(serie,ylim=c(-1,1),lag.max=60,col=c(rep(1,3),2), main ="PACF(serie)",lwd=2)
par(mfrow=c(1,2))

```

#### Final transformation for the GDPUSAvar series: $W_t= X_t$

```{r}
(mod1<-arima(serie,order=c(2,0,0)))
```

```{r}
resi=resid(mod1)
par(mfrow=c(1,2))
acf(resi,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,3)), main ="ACF(Resid)",lwd=2)
pacf(resi,ylim=c(-1,1),lag.max=60,col=c(rep(1,3),2), main ="PACF(Resid)",lwd=2)
par(mfrow=c(1,2))

```

```{r}
(mod2<-arima(serie,order=c(0,0,3)))
```
```{r}
resi=resid(mod2)
par(mfrow=c(1,2))
acf(resi,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,3)), main ="ACF(Resid)",lwd=2)
pacf(resi,ylim=c(-1,1),lag.max=60,col=c(rep(1,3),2), main ="PACF(Resid)",lwd=2)
par(mfrow=c(1,2))

```


### EURODOL

### I. Exploratory data analysis and transformation into stationarity

#### Ia. Exploratory data analysis

Import the data

```{r}
(serie=ts((read.table("eurodol.dat",header=F)),start=1995,freq=12))
```

```{r}
plot(serie)
abline(v=1990:2020,col=4,lty=3)
abline(h=0)
```

#### Ib. Tranforming series into a stationary one:


```{r}
groupedserie <- matrix(serie, ncol=12) #12 quarters=3yrs together=ncol=12
boxplot(groupedserie)
```

#### Is seasonality present?

monthplot(serie)

ts.plot(matrix(serie,nrow=12),col=1:8)

#### Is the mean constant?

```{r}
plot(serie)
abline(h=0)
abline(h=mean(serie),col=2)
```
```{r}
mean(serie) 
```


#### Check for over-differentiation: Take an extra differentiation and compare the variances.

```{r}
d1serie=diff(serie)
plot(d1serie)
abline(h=0)
abline(h=mean(d1serie),col=2)
```

```{r}
var(serie)
var(d1serie)
var(diff(d1serie))
```

#### Is an extra differentiation needed?

#### Is the current series already stationary? Plot the ACF and decide!!

```{r}
par(mfrow=c(1,2))
acf(d1serie,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,11)), main ="ACF(serie)",lwd=2)
pacf(d1serie,ylim=c(-1,1),lag.max=60,col=c(rep(1,11),2), main ="PACF(serie)",lwd=2)
par(mfrow=c(1,2))

```

#### Final transformation for the GDPUSAvar series: $W_t= X_t$

```{r}
(mod1<-arima(serie,order=c(1,1,0)))
```

```{r}
resi=resid(mod1)
par(mfrow=c(1,2))
acf(resi,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,11)), main ="ACF(Resid)",lwd=2)
pacf(resi,ylim=c(-1,1),lag.max=60,col=c(rep(1,11),2), main ="PACF(Resid)",lwd=2)
par(mfrow=c(1,2))

```

```{r}
(mod2<-arima(serie,order=c(0,1,1)))
```
```{r}
resi=resid(mod2)
par(mfrow=c(1,2))
acf(resi,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,11)), main ="ACF(Resid)",lwd=2)
pacf(resi,ylim=c(-1,1),lag.max=60,col=c(rep(1,11),2), main ="PACF(Resid)",lwd=2)
par(mfrow=c(1,2))

```
